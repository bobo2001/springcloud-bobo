<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/bootstrap/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css">
    <link rel="stylesheet" href="/bootstrap/bootstrap3/css/bootstrap.css">
    <link rel="stylesheet" href="/bootstrap/bootstrap-table/bootstrap-table.css">
    <link rel="stylesheet" href="/bootstrap/bootstrap-fileinput/css/fileinput.css">
    <link rel="stylesheet" href="/bootstrap/bootstrap-treeview/bootstrap-treeview.min.css">
    <link rel="stylesheet" href="/bootstrap/bootStrap-addTabs/bootstrap.addtabs.css">
    <script src="/bootstrap/easyui1.5/jquery.min.js"></script>
    <script src="/bootstrap/bootstrap3/js/bootstrap.js"></script>
    <script src="/bootstrap/bootstrap-table/bootstrap-table.js"></script>
    <script src="/bootstrap/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>
    <script src="/bootstrap/bootbox/bootbox.all.min.js"></script>
    <script src="/bootstrap/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
    <script src="/bootstrap/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
    <script src="/bootstrap/bootstrap-fileinput/js/fileinput.js"></script>
    <script src="/bootstrap/bootstrap-fileinput/js/locales/zh.js"></script>
    <script src="/bootstrap/bootstrap-treeview/bootstrap-treeview.min.js"></script>
    <script src="/bootstrap/bootStrap-addTabs/bootstrap.addtabs.min.js"></script>
</head>
<body>
<div id="toolbar">
    <form class="form-inline">
        <div class="form-group">
            <label for="name">åº•éƒ¨åç§°</label>
            <input type="text" class="form-control"id="name" placeholder="è¯·è¾“å…¥åç§°">
        </div>
        <button type="button" onclick="searchUser()" class="btn btn-success glyphicon glyphicon-search">æœç´¢ğŸ”</button>
        <button type="button" onclick="clearss()" class="btn btn-warning ">æ¸…ç©ºæŸ¥è¯¢</button>
    </form>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-danger" onclick="delDiBu()">åˆ é™¤</button>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" onclick="openAddUser()" class="btn btn-info glyphicon glyphicon-plus">æ–°å¢</button>
</div>
<table id="DiBuTable"></table>
</body>

<script type="text/javascript">
    //æ–°å¢å¼¹æ¡†
    var res;
    function createAddContent(url){
        $.ajax({
            url:url,
            async:false,//åŒæ­¥
            success:function(data){
                res = data;
            }
        });
        return res;
    }


    //æ‰“å¼€æ–°å¢å¼¹æ¡†
    function openAddUser(){
        bootbox.dialog({
            title:'æ–°å¢ç”¨æˆ·',
            message: createAddContent("/zhuanqu/toAddDiBu"),
            closeButton: true,//æ˜¯å¦æ˜¾ç¤ºå…³é—­æŒ‰é’®
            buttons : {
                "success" : {
                    "label" : "<i class='icon-ok'></i> ä¿å­˜",
                    "className" : "btn-sm btn-success",
                    "callback" : function() {
                        $.ajax({
                            url:'/zhuanqu/saveDiBu',
                            type:'post',
                            data:$("#myForm").serialize(),
                            success:function(data){
                                //åˆ·æ–°è¡¨æ ¼
                                //$('#myTable').bootstrapTable('refresh');
                                searchUser();
                            }
                        });
                    }
                },
                "cancel" : {
                    "label" : "<i class='icon-info'></i> å–æ¶ˆ",
                    "className" : "btn-sm btn-danger",
                    "callback" : function() {

                    }
                }
            }

        });

    }
    /*æŸ¥è¯¢*/
    $("#DiBuTable").bootstrapTable({
        url: '/zhuanqu/findDiBuList',
        toolbar: '#toolbar',
        pagination: true, //æ˜¯å¦å±•ç¤ºåˆ†é¡µ
        pageList: [1,3, 5, 10, 20, 50],//åˆ†é¡µç»„ä»¶
        pageNumber: 1,
        pageSize: 3,//é»˜è®¤æ¯é¡µæ¡æ•°
        //é¡µé¢ä¿®é¥°
        showRefresh: true,//æ˜¯å¦æ˜¾ç¤ºåˆ·æ–°æŒ‰é’®
        showToggle: true,//æ˜¯å¦æ˜¾ç¤º åˆ‡æ¢è¯•å›¾ï¼ˆtable/cardï¼‰æŒ‰é’®
        detailView: true,//è®¾ç½®ä¸º true å¯ä»¥æ˜¾ç¤ºè¯¦ç»†é¡µé¢æ¨¡å¼ã€‚
        showColumns: true,//æ˜¯å¦æ˜¾ç¤º å†…å®¹åˆ—ä¸‹æ‹‰æ¡†
        clickToSelect: true, //æ˜¯å¦å¯ç”¨ç‚¹å‡»é€‰ä¸­è¡Œ
        showPaginationSwitch: true,//æ˜¯å¦æ˜¾ç¤º æ•°æ®æ¡æ•°é€‰æ‹©æ¡†
        //è§£å†³æ¡æŸ¥ä¹±ç 
        method: "post",
        contentType:'application/x-www-form-urlencoded;charset=UTF-8',   //æ•°æ®ç¼–ç çº¯æ–‡æœ¬  offset=0&limit=5
        //ä¼ é€’å‚æ•°,æ¡ä»¶æŸ¥è¯¢,åˆ†é¡µä¼ å‚
        /*queryParams: function () {
            return {
                //æœ‰åˆ†é¡µçš„å›ºå®šä¼ å€¼
                page: this.pageNumber,
                rows: this.pageSize,
            }
        },*/

        sidePagination: 'client',
        columns: [
            {field:"000",checkbox:true},
            {field:'id',title:'ç¼–å·'},
            {field:'name',title:'å¯¼èˆªåç§°'},
            {field:'paixu',title:'æ’åº'},
            {field:'status',title:'çŠ¶æ€',formatter:function (value,row,index){
                    var stu = "";
                    if (row.status == 1){
                        stu = "æ­£å¸¸";
                    }
                    if(row.status == 0){
                        stu = "å¼‚å¸¸";
                    }
                    return stu;
                }},
            {field:'1sd3',title:'æ“ä½œ',formatter:function(value,row,index){
                   /* return '<a href="javascript:delDiBu('+row.id+')">åˆ é™¤</a>  |  <a href="javascript:update('+row.id+')">ä¿®æ”¹</a>';*/
                   return '<button type="button" class="btn btn-success" onclick="editUser('+row.id+')" class="btn btn-info">ä¿®æ”¹</button>' +
                        '<button type="button" class="btn btn-danger" onclick="delDiBu('+row.id+')" class="btn btn-info">åˆ é™¤</button>' +
                        '<button type="button" class="btn btn-warning" onclick="updrole('+row.id+')" class="btn btn-info">ç¦ç”¨</button>' +
                        '<button type="button" class="btn btn-success"  onclick="updpasw('+row.id+')" class="btn btn-info">ä¸“åŒºè¯¾ç¨‹</button>';
                }}

        ]
    })
    //æ‰¹é‡åˆ é™¤
    function delDiBu(){
        var arr = $("#DiBuTable").bootstrapTable("getSelections");
        if(arr.length<=0){//æ²¡æœ‰é€‰æ‹©
            //bootbox.alert("è¯·è‡³å°‘é€‰æ‹©ä¸€æ¡!");
            bootbox.alert({
                size: "small",
                title: "æç¤º",
                message: "è¯·è‡³å°‘é€‰æ‹©ä¸€æ¡!",
                buttons: {
                    ok: {
                        label: 'ç¡®å®š',
                        className: 'btn-success'
                    }
                },
                callback: function(){}
            })
        }else{
            bootbox.confirm({
                size: "small",
                title: "æç¤º",
                message: "æ˜¯å¦ç¡®è®¤åˆ é™¤ï¼Ÿ",
                buttons: {
                    confirm: {
                        label: 'ç¡®å®š',
                        className: 'btn-success'
                    },
                    cancel: {
                        label: 'å–æ¶ˆ',
                        className: 'btn-danger'
                    }
                },
                callback: function(result){
                    if(result){
                        //åˆ é™¤
                        var ids = "";
                        for(var i=0;i<arr.length;i++){
                            ids+=ids==""?arr[i].id:","+arr[i].id;
                        }
                        alert(ids);
                        $.ajax({
                            url:"/zhuanqu/delDiBuByIds",
                            type:"post",
                            data:{ids:ids},
                            success:function(){
                                //æç¤ºåˆ é™¤æˆåŠŸ
                                bootbox.alert({
                                    size: "small",
                                    title: "æç¤º",
                                    message: "åˆ é™¤æˆåŠŸ!",
                                    buttons: {
                                        ok: {
                                            label: 'ç¡®å®š',
                                            className: 'btn-success'
                                        }
                                    },
                                    callback: function(){}
                                })
                                //åˆ·æ–°è¡¨æ ¼
                                $("#DiBuTable").bootstrapTable("refresh");//è¡¨æ ¼åˆ·æ–°æ•°æ®;
                            }
                        })
                    }
                }
            })
        }
    }
    //æ‰“å¼€ä¿®æ”¹é¡µé¢ï¼šå›æ˜¾
    function editUser(id){
        bootbox.dialog({
            title:'ä¿®æ”¹ç”¨æˆ·',
            message: createAddContent("/zhuanqu/toAddDiBu"),
            closeButton: true,//æ˜¯å¦æ˜¾ç¤ºå…³é—­æŒ‰é’®
            buttons : {
                "success" : {
                    "label" : "<i class='icon-ok'></i> ä¿å­˜",
                    "className" : "btn-sm btn-success",
                    "callback" : function() {
                        $.ajax({
                            url:'/saveZhuanQu',
                            type:'post',
                            data:$("#myForm").serialize(),
                            success:function(data){
                                //åˆ·æ–°è¡¨æ ¼
                                $('#OrderTable').bootstrapTable('refresh');
                                // searchUser();
                            }
                        });
                    }
                },
                "cancel" : {
                    "label" : "<i class='icon-info'></i> å–æ¶ˆ",
                    "className" : "btn-sm btn-danger",
                    "callback" : function() {

                    }
                }
            }

        });

        //å›æ˜¾æ•°æ®
        $.ajax({
            url:"/EditDiBuById",
            type:"post",
            async:false,//åŒæ­¥
            data:{id:id},
            success:function(data){
                $("#id").val(data.id);
                $("#name").val(data.name);
                $("#title").val(data.title);
                $("#paixu").val(data.paixu);
                $(":input[name='status']").each(function(){
                    //debugger;
                    var sex = $(this).val();
                    if(sex==data.status){
                        $(this).prop("checked",true);
                    }
                })



            }
        })
    }
</script>
</html>